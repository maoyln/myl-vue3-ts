# 11、标签拖拽完整面板预览优化

> 本文档记录了标签拖拽时显示完整面板内容的优化

## 优化时间
2026-01-15

## 优化内容

### 问题描述
之前的实现中，拖拽标签时只显示一个小的标签预览（图标+标题），用户无法看到标签对应的完整内容，体验不够直观。

**之前的效果**：
- 只显示标签的图标和标题
- 预览很小，只有一行
- 无法预览标签对应的实际内容

**期望的效果**：
- 显示完整的面板预览（包括标签栏和内容区）
- 预览保持原面板的尺寸
- 跟随鼠标实时移动
- 半透明效果，不完全遮挡下方内容

---

## 实现方案

### 1. 修改预览结构

将简单的标签预览改为完整的面板预览结构：

**之前的结构**：
```vue
<div class="tab-drag-preview">
  <span class="tab-preview-icon">图标</span>
  <span class="tab-preview-title">标题</span>
</div>
```

**新的结构**：
```vue
<div class="panel-drag-preview">
  <!-- 标签栏 -->
  <div class="preview-tabs-header">
    <div class="preview-tabs-container">
      <div class="preview-tab active">
        <span class="tab-icon">图标</span>
        <span class="tab-title">标题</span>
      </div>
    </div>
  </div>
  
  <!-- 内容区 -->
  <div class="preview-content">
    <slot name="panel-group-content" :group="draggedGroup" :activeTab="draggedTab">
      <!-- 默认占位内容 -->
    </slot>
  </div>
</div>
```

### 2. 添加计算属性

添加 `draggedGroup` 计算属性获取被拖拽标签所在的面板组：

```typescript
// 获取被拖拽标签所在的面板组
const draggedGroup = computed(() => {
  if (!tabDragInfo.value) return null;
  
  return manager.getPanelGroup?.(tabDragInfo.value.groupId);
});
```

### 3. 更新样式函数

修改预览样式函数，使用面板组的实际尺寸：

**之前**：
```typescript
function getTabPreviewStyle() {
  return {
    left: `${currentX + 10}px`,
    top: `${currentY + 10}px`,
  };
}
```

**现在**：
```typescript
function getPanelPreviewStyle() {
  if (!tabDragInfo.value || !draggedGroup.value) return {};
  
  // 使用面板组的实际尺寸
  const width = draggedGroup.value.width || 280;
  const height = draggedGroup.value.height || 300;
  
  return {
    left: `${tabDragInfo.value.currentX + 15}px`,
    top: `${tabDragInfo.value.currentY + 15}px`,
    width: `${width}px`,
    height: `${height}px`,
  };
}
```

### 4. 完善CSS样式

添加完整的面板预览样式：

```css
/* 面板拖拽预览 */
.panel-drag-preview {
  position: fixed;
  display: flex;
  flex-direction: column;
  background-color: #2d2d2d;
  border: 2px solid #4A90E2;
  border-radius: 6px;
  pointer-events: none;
  z-index: 10000;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
  opacity: 0.85; /* 半透明效果 */
  overflow: hidden;
}

/* 预览标签栏 */
.preview-tabs-header {
  display: flex;
  background-color: #3e3e3e;
  border-bottom: 1px solid #555;
  min-height: 36px;
}

/* 预览标签 */
.preview-tab {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  background-color: #2d2d2d;
  color: #fff;
  border-bottom: 2px solid #4A90E2; /* 激活状态 */
}

/* 预览内容区 */
.preview-content {
  flex: 1;
  overflow: hidden;
  background-color: #252525;
  color: #e0e0e0;
}
```

---

## 技术要点

### 1. 插槽复用

使用 `panel-group-content` 插槽复用实际面板的内容：

```vue
<slot name="panel-group-content" :group="draggedGroup" :activeTab="draggedTab">
  <div class="preview-placeholder">
    <p><strong>{{ draggedTab.title }}</strong></p>
    <p>正在拖拽...</p>
  </div>
</slot>
```

**优势**：
- 显示真实的面板内容
- 自动同步内容更新
- 保持与原面板一致的样式

### 2. 尺寸保持

预览面板使用原面板组的实际尺寸：

```typescript
const width = draggedGroup.value.width || 280;
const height = draggedGroup.value.height || 300;
```

**效果**：
- 预览尺寸与原面板一致
- 给用户准确的视觉反馈
- 便于判断停靠后的效果

### 3. 半透明设计

使用 `opacity: 0.85` 实现半透明效果：

```css
.panel-drag-preview {
  opacity: 0.85;
}
```

**优势**：
- 不完全遮挡下方内容
- 可以看到热区提示
- 视觉上更舒适

### 4. 事件穿透

使用 `pointer-events: none` 避免干扰鼠标事件：

```css
.panel-drag-preview {
  pointer-events: none;
}
```

**作用**：
- 预览不会捕获鼠标事件
- 不影响下方元素的交互
- 确保热区检测正常工作

---

## 优化效果

### 视觉体验改进

**之前**：
```
拖拽标签
   ↓
只显示一行文字
[🔧 工具箱]
```

**现在**：
```
拖拽标签
   ↓
显示完整面板
┌─────────────────┐
│ 🔧 工具箱       │ ← 标签栏
├─────────────────┤
│                 │
│  面板内容区域   │ ← 实际内容
│                 │
└─────────────────┘
```

### 用户体验提升

1. **直观性**：可以看到完整的面板内容，知道要拖拽什么
2. **准确性**：预览尺寸与实际一致，便于判断停靠效果
3. **连贯性**：拖拽过程中始终能看到完整内容
4. **专业性**：视觉效果更接近专业软件（如Photoshop）

### 交互体验优化

1. **实时反馈**：面板跟随鼠标实时移动
2. **内容预览**：可以看到标签对应的实际内容
3. **尺寸感知**：清楚知道停靠后会占用多大空间
4. **操作信心**：完整预览增强操作信心

---

## 测试建议

### 测试场景1：拖拽单个标签
1. 创建一个有多个标签的面板组
2. 拖拽其中一个标签
3. 预期：
   - 显示完整的面板预览
   - 预览跟随鼠标移动
   - 预览保持原面板尺寸
   - 半透明，可以看到下方内容

### 测试场景2：不同尺寸的面板
1. 创建不同尺寸的面板组（小、中、大）
2. 分别拖拽每个面板的标签
3. 预期：
   - 预览尺寸与原面板一致
   - 小面板显示小预览
   - 大面板显示大预览

### 测试场景3：内容同步
1. 创建一个面板组，内容会实时变化
2. 拖拽标签
3. 预期：
   - 预览显示当前的实际内容
   - 内容与原面板一致

### 测试场景4：与热区的配合
1. 拖拽标签到其他面板组
2. 观察预览和热区的关系
3. 预期：
   - 可以透过预览看到热区高亮
   - 预览不影响热区检测
   - 插入指示线正常显示

---

## 对比效果

| 特性 | 之前的实现 | 现在的实现 |
|------|-----------|-----------|
| **预览大小** | 一行文字（~150px） | 完整面板（280x300px） |
| **显示内容** | 图标+标题 | 标签栏+完整内容 |
| **尺寸感知** | 无法判断 | 清晰准确 |
| **内容预览** | 无 | 完整显示 |
| **专业性** | 一般 | 接近专业软件 |
| **用户体验** | 基础 | 优秀 |

---

## 相关文件

### 修改的文件
1. **src/components/docking/DockContainer.vue**
   - 修改预览HTML结构
   - 添加 `draggedGroup` 计算属性
   - 修改 `getPanelPreviewStyle` 函数
   - 更新CSS样式

### 关键代码位置

```vue
<!-- DockContainer.vue -->

<!-- 预览元素 -->
<div 
  v-if="tabDragInfo && draggedTab && draggedGroup" 
  class="panel-drag-preview"
  :style="getPanelPreviewStyle()"
>
  <!-- 标签栏 + 内容区 -->
</div>

<!-- 计算属性 -->
<script setup>
const draggedGroup = computed(() => {
  if (!tabDragInfo.value) return null;
  return manager.getPanelGroup?.(tabDragInfo.value.groupId);
});
</script>
```

---

## 后续优化建议

### 1. 性能优化
- 使用 `transform` 代替 `left/top`，提升渲染性能
- 添加防抖，减少重绘频率
- 考虑使用 CSS 硬件加速

### 2. 视觉优化
- 添加拖拽开始时的缩放动画
- 添加阴影的动态变化
- 考虑添加跟随鼠标的旋转效果

### 3. 内容优化
- 对于内容很多的面板，考虑简化预览
- 添加内容截断提示
- 优化滚动内容的显示

### 4. 配置选项
- 允许用户选择预览模式（简单/完整）
- 预览透明度可配置
- 预览尺寸缩放比例可配置

---

## 实现对比

### 简化预览（之前）

```vue
<!-- 简单的标签预览 -->
<div class="tab-drag-preview">
  🔧 工具箱
</div>
```

**优点**：
- 实现简单
- 性能好
- 不遮挡视线

**缺点**：
- 信息量少
- 无法预览内容
- 不够直观

### 完整预览（现在）

```vue
<!-- 完整的面板预览 -->
<div class="panel-drag-preview">
  <div class="preview-tabs-header">
    <div class="preview-tab">🔧 工具箱</div>
  </div>
  <div class="preview-content">
    <!-- 实际内容 -->
  </div>
</div>
```

**优点**：
- 信息完整
- 视觉直观
- 专业感强
- 用户体验好

**缺点**：
- 稍微复杂
- 可能遮挡视线（通过半透明解决）

---

## 用户反馈预期

### 正面反馈
- "拖拽时能看到完整内容，很直观"
- "知道拖拽的是什么，更有信心"
- "预览尺寸准确，方便判断停靠效果"
- "视觉效果很专业，像Photoshop"

### 可能的改进点
- "大面板的预览可能太大"（考虑添加缩放）
- "预览可能遮挡热区"（已通过半透明解决）
- "希望能自定义预览样式"（后续可添加配置）

---

## 版本信息
- 优化版本：v1.6
- 优化日期：2026-01-15
- 优化人员：AI Assistant
- 相关文档：
  - 09、标签拖拽细节优化说明.md
  - 10、标签拖拽交互优化说明.md
