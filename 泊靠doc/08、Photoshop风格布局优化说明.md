# Photoshop 风格布局优化说明

## 概述

本次优化实现了类似 Photoshop 的面板自动布局系统，面板会根据停靠位置和数量自动调整尺寸，避免重叠，提供更好的用户体验。

## 主要功能

### 1. 单个面板自动填充

#### 左右停靠
- 单个面板吸附到容器左侧或右侧时，**高度自动变成 100%**
- 宽度保持用户设置的值（在合理范围内）

#### 上下停靠
- 单个面板吸附到容器顶部或底部时，**宽度自动变成 100%**
- 高度保持用户设置的值（在合理范围内）

### 2. 多面板自动平分空间

#### 左右停靠
- 多个面板吸附到同一侧（左或右）时，**高度自动平均分配**
- 例如：3个面板停靠在左侧，每个面板占据容器高度的 1/3
- 宽度独立设置，互不影响

#### 上下停靠
- 多个面板吸附到同一侧（上或下）时，**宽度自动平均分配**
- 例如：2个面板停靠在顶部，每个面板占据容器宽度的 1/2
- 高度独立设置，互不影响

### 3. 智能吸附点

#### 容器边缘吸附
- 将面板拖拽到容器边缘（左、右、上、下）的热区时触发吸附
- 热区大小：50像素
- 吸附预览会显示面板将要占据的实际空间（考虑现有面板数量）

#### 面板连接处吸附
- 可以在已停靠的面板之间插入新面板
- 吸附点位于面板的边缘（上下边缘用于左右停靠，左右边缘用于上下停靠）
- 插入新面板后，所有面板会自动重新分配空间

### 4. 防止重叠

- 所有停靠面板的尺寸由布局管理器统一控制
- 使用 Flexbox 布局确保面板完美贴合，无缝隙、无重叠
- 面板和面板组可以混合停靠，统一管理

### 5. 动态布局更新

系统会在以下情况自动更新布局：
- 添加新面板到停靠区域
- 移除停靠面板
- 将停靠面板拖拽到其他位置
- 分离停靠面板（变为浮动）
- 调整停靠面板大小
- 窗口大小改变

## 使用示例

### 创建默认布局

```javascript
// 添加左侧工具面板 - 独占左侧，高度100%
manager.addPanel({
  id: 'tools-1',
  title: '工具箱',
  width: 250,
  height: 400,
  defaultPosition: 'left',
});

// 添加第二个左侧面板 - 自动平分高度，每个50%
manager.addPanel({
  id: 'layers-1',
  title: '图层',
  width: 280,
  height: 450,
  defaultPosition: 'left',
});
```

### 手动拖拽停靠

1. 拖拽面板到容器左边缘 → 面板将占据左侧全部高度
2. 拖拽另一个面板到已停靠面板的下边缘 → 两个面板平分左侧高度
3. 拖拽第三个面板到第一个和第二个面板之间 → 三个面板平分左侧高度

## 技术实现

### 核心函数

#### `updateDockedPanelsByPosition(position: DockPosition)`
- 更新指定位置所有停靠面板的尺寸
- 自动计算并分配空间
- 同时处理面板和面板组

#### `detectContainerEdgeSnap(mouseX, mouseY, containerR)`
- 检测容器边缘吸附
- 计算并显示正确的预览尺寸

#### `detectPanelSnap(panel, mouseX, mouseY)`
- 检测面板连接处吸附
- 支持在已停靠面板之间插入

### 布局更新时机

```typescript
// 添加面板后
addPanel(config) → updateDockedPanelsByPosition()

// 移除面板后
removePanel(id) → updateDockedPanelsByPosition()

// 拖拽结束后
endDrag() → updateDockedPanelsByPosition()

// 分离面板后
handleDetach() → updateDockedPanelsByPosition()

// 窗口大小改变后
handleResize() → updateDockedPanelsByPosition() × 4 (每个方向)
```

## 样式调整

### 停靠区域
- 移除了固定的 `min-width`、`max-width`、`min-height`、`max-height` 限制
- 完全由面板自身的尺寸控制停靠区域大小

### 面板样式
- 停靠状态：使用 `flex: 0 0 auto`，尺寸由布局管理器控制
- 浮动状态：使用 `position: fixed`，尺寸由用户拖拽控制

## 预设布局示例

### 默认布局
- 左侧：工具箱（独占，高度100%）
- 右侧：图层面板（独占，高度100%）

### 设计布局
- 左侧：工具箱 + 颜色面板（各占50%高度）
- 右侧：图层 + 属性面板（各占50%高度）

### 代码布局
- 顶部：工具箱（独占，宽度100%）
- 底部：历史记录 + 属性面板（各占50%宽度）

## 注意事项

1. **最小尺寸限制**：面板有最小宽度（200px）和最小高度（100px）限制
2. **最大尺寸限制**：停靠面板不会超过容器尺寸的40%（可配置）
3. **性能优化**：使用 `setTimeout` 延迟布局更新，避免频繁计算
4. **响应式**：窗口大小改变时自动重新计算所有停靠面板的尺寸

## 与 Photoshop 的对比

| 特性 | Photoshop | 本实现 | 状态 |
|-----|-----------|--------|------|
| 单面板自动填充 | ✓ | ✓ | ✅ 已实现 |
| 多面板平分空间 | ✓ | ✓ | ✅ 已实现 |
| 面板连接处吸附 | ✓ | ✓ | ✅ 已实现 |
| 防止重叠 | ✓ | ✓ | ✅ 已实现 |
| 响应式布局 | ✓ | ✓ | ✅ 已实现 |
| 面板组支持 | ✓ | ✓ | ✅ 已实现 |
| 保存/加载布局 | ✓ | ⚠️ | 🔄 可扩展 |
| 自定义热区 | ✓ | ✓ | ✅ 已实现 |

## 未来改进方向

1. **布局持久化**：保存用户的布局配置到本地存储
2. **更多停靠选项**：支持面板四分之一吸附（角落位置）
3. **动画优化**：添加平滑的尺寸变化动画
4. **拖拽预览优化**：显示半透明的面板预览
5. **键盘快捷键**：支持通过快捷键快速停靠/分离面板

## 相关文件

- `src/components/docking/useDockManager.ts` - 核心布局管理逻辑
- `src/components/docking/DockContainer.vue` - 容器组件
- `src/components/docking/DockablePanel.vue` - 面板组件
- `src/components/docking/DockablePanelGroup.vue` - 面板组组件
- `src/views/DockingDemo.vue` - 演示页面
