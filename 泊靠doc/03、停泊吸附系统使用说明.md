# 停泊吸附系统使用说明

## 概述

本系统实现了类似 Photoshop 的面板停泊吸附功能，包含完整的拖拽、吸附、停泊等交互效果。

## 核心组件

### 1. DockContainer（停泊容器）

停泊系统的容器组件，管理所有面板的布局和交互。

**使用方法：**

```vue
<template>
  <DockContainer ref="dockContainerRef" :config="dockConfig">
    <!-- 主内容区 -->
    <div class="main-content">
      <!-- 你的内容 -->
    </div>
  </DockContainer>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import { DockContainer } from '@/components/docking';
import type { DockManagerConfig } from '@/components/docking';

const dockContainerRef = ref<InstanceType<typeof DockContainer>>();

const dockConfig: DockManagerConfig = {
  snapThreshold: 30,      // 停泊区吸附阈值（像素）
  hotZoneSize: 50,        // 热区大小（像素）
  minPanelWidth: 200,     // 最小面板宽度
  minPanelHeight: 150,    // 最小面板高度
};

// 获取管理器
const getManager = () => dockContainerRef.value?.manager;

// 添加面板
function addPanel() {
  const manager = getManager();
  if (!manager) return;

  manager.addPanel({
    id: 'panel-1',
    title: '工具箱',
    width: 250,
    height: 400,
    defaultPosition: 'left', // 'left' | 'right' | 'top' | 'bottom' | 'float'
    closable: true,
    resizable: true,
  });
}
</script>
```

### 2. DockablePanel（可停泊面板）

可拖拽的面板组件，由 DockContainer 内部自动创建和管理。

**特性：**
- 支持拖拽移动
- 支持吸附对齐
- 支持停泊到容器边缘
- 支持调整大小
- 支持关闭和分离

### 3. GuideLine（对齐辅助线）

显示吸附对齐时的辅助线，由 DockContainer 内部自动管理。

**特性：**
- 自动显示/隐藏
- 支持水平和垂直方向
- 可自定义颜色和样式

## 核心工具类

### 1. useDockManager（停泊管理器）

管理所有面板的状态、拖拽、吸附等功能。

**主要方法：**

```typescript
const manager = useDockManager(config);

// 添加面板
manager.addPanel(panelConfig);

// 移除面板
manager.removePanel(panelId);

// 获取面板
const panel = manager.getPanel(panelId);

// 激活面板（提升到最前）
manager.activatePanel(panelId);

// 调整面板大小
manager.resizePanel(panelId, width, height);
```

### 2. useSnapCalculator（吸附计算器）

计算面板间的吸附对齐。

**功能：**
- 面板与面板对齐（左、右、上、下、中心）
- 面板与容器对齐
- 显示对齐辅助线

### 3. useDragState（拖拽状态管理）

管理拖拽全流程的状态。

**功能：**
- 拖拽状态维护
- 速度计算
- 边界约束
- 键盘事件处理（Esc 取消、Alt 禁用吸附）

## 完整示例

参考 `src/views/DockingDemo.vue` 查看完整的使用示例。

### 基础用法

```vue
<template>
  <div class="app">
    <DockContainer ref="containerRef" :config="config">
      <div class="content">
        <button @click="addToolPanel">添加工具面板</button>
        <button @click="addLayerPanel">添加图层面板</button>
      </div>
    </DockContainer>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import { DockContainer } from '@/components/docking';

const containerRef = ref();
let panelId = 0;

function addToolPanel() {
  containerRef.value?.manager.addPanel({
    id: `tools-${++panelId}`,
    title: '工具箱',
    width: 250,
    height: 400,
    defaultPosition: 'left',
    closable: true,
    resizable: true,
  });
}

function addLayerPanel() {
  containerRef.value?.manager.addPanel({
    id: `layers-${++panelId}`,
    title: '图层',
    width: 280,
    height: 450,
    defaultPosition: 'right',
    closable: true,
    resizable: true,
  });
}
</script>
```

## 交互说明

### 拖拽操作
- 点击面板标题栏并拖动可移动面板
- 拖动过程中会自动吸附到其他面板或容器边缘
- 拖动到容器边缘热区可停泊固定

### 键盘快捷键
- **Esc**：取消拖拽，面板返回初始位置
- **Alt**：按住时禁用吸附功能

### 吸附功能
- 面板边缘距离 ≤ 8px 时触发吸附
- 显示蓝色辅助线提示对齐位置
- 支持左、右、上、下、中心对齐

### 停泊功能
- 拖动到容器边缘热区（50px）触发停泊
- 停泊后显示半透明预览框
- 停泊面板自动适配容器尺寸

### 调整大小
- 浮动面板：可拖动右、下、右下角调整
- 停泊面板：可拖动对应边缘调整

## 面板状态

### 面板配置（PanelConfig）

```typescript
interface PanelConfig {
  id: string;              // 唯一标识
  title: string;           // 标题
  width?: number;          // 宽度
  height?: number;         // 高度
  minWidth?: number;       // 最小宽度
  minHeight?: number;      // 最小高度
  defaultPosition?: DockPosition; // 默认位置
  closable?: boolean;      // 是否可关闭
  resizable?: boolean;     // 是否可调整大小
}
```

### 停泊位置（DockPosition）

- `'left'`：左侧停泊
- `'right'`：右侧停泊
- `'top'`：顶部停泊
- `'bottom'`：底部停泊
- `'float'`：浮动状态
- `'center'`：中心位置

### 面板状态（PanelState）

- `'docked'`：已停泊
- `'floating'`：浮动
- `'dragging'`：拖拽中

## 高级配置

### 自定义配置

```typescript
const config: DockManagerConfig = {
  snapThreshold: 30,      // 停泊区吸附距离（默认 30px）
  hotZoneSize: 50,        // 热区大小（默认 50px）
  minPanelWidth: 200,     // 最小面板宽度（默认 200px）
  minPanelHeight: 150,    // 最小面板高度（默认 150px）
};
```

### 预设布局

```typescript
// 默认布局
function loadDefaultLayout() {
  manager.addPanel({
    id: 'tools',
    title: '工具箱',
    defaultPosition: 'left',
    // ...
  });
  
  manager.addPanel({
    id: 'layers',
    title: '图层',
    defaultPosition: 'right',
    // ...
  });
}

// 清空布局
function resetLayout() {
  const panels = manager.panelList.value;
  panels.forEach(panel => {
    manager.removePanel(panel.id);
  });
}
```

## 注意事项

1. **容器尺寸**：DockContainer 必须有明确的宽度和高度
2. **面板 ID**：每个面板的 ID 必须唯一
3. **响应式数据**：面板状态是响应式的，可以直接在模板中使用
4. **性能优化**：避免同时创建过多面板（建议 ≤ 20 个）
5. **浏览器兼容**：支持 Chrome、Firefox、Safari、Edge 最新版本

## 路由配置

系统已自动配置路由，访问路径：

- **演示页面**：`/docking-demo`
- **基础框架**：`/berthing-frame`

## 故障排除

### 面板无法拖动
- 检查是否正确注册了 DockContainer
- 确认面板的 state 不是 'docked'

### 吸附不生效
- 检查 snapThreshold 配置
- 确认没有按住 Alt 键

### 停泊不生效
- 检查 hotZoneSize 配置
- 确认拖动到了容器边缘

### 类型错误
- 确保安装了所有依赖：`npm install`
- 检查 tsconfig 配置是否正确

## 更多帮助

参考文档：
- [01、需求列表](./01、Photoshop风格组件拖拽、停泊吸附功能需求列表.md)
- [02、工具类与组件拆解分析](./02、Vue3%20实现%20PS%20风格拖拽停泊吸附功能%20-%20工具类与组件拆解分析.md)
