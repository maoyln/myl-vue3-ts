# 三级面板结构 - 可视化结构图 🎨

## 📐 完整结构图

```
┌─────────────────────────────────────────────────────────────────┐
│                    DockManagerV2（总管理器）                      │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │          管理所有容器 + 全局热区检测 + 拖拽Ghost          │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
              │
              ├─────────────┬─────────────┬─────────────┐
              ↓             ↓             ↓             ↓
    ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
    │  容器1(左)  │ │  容器2(右)  │ │  容器3(底)  │ │  容器4(浮)  │
    │ 第一级组件  │ │ 第一级组件  │ │ 第一级组件  │ │ 第一级组件  │
    │────────────│ │────────────│ │────────────│ │────────────│
    │ • 位置:left│ │ • 位置:right│ │ • 位置:bottom│ │ • 位置:float│
    │ • 宽度:300 │ │ • 宽度:320 │ │ • 高度:200 │ │ • 宽高自由  │
    │ • 方向:纵向│ │ • 方向:纵向│ │ • 方向:横向│ │ • 可拖拽    │
    └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
         │                │                │                │
         ├───┬───┐        ├───┬───┐       │                │
         ↓   ↓   ↓        ↓   ↓   ↓       ↓                ↓
    ┌─────┬─────┬─────┐ ┌─────┬─────┐ ┌─────────────┐ ┌─────────┐
    │分组A│分组B│分组C│ │分组D│分组E│ │   分组F     │ │  分组G  │
    │ 60%│ 25%│ 15%│ │ 50%│ 50%│ │    100%     │ │  100%  │
    │第二级│第二级│第二级│ │第二级│第二级│ │  第二级     │ │ 第二级  │
    └─────┴─────┴─────┘ └─────┴─────┘ └─────────────┘ └─────────┘
         │       │       │       │       │                │
         ├─┬─┐   │       │       ├─┬─┐   │                │
         ↓ ↓ ↓   ↓       ↓       ↓ ↓ ↓   ↓                ↓
    ┌───┬───┬───┐ ┌───┐ ┌───┐ ┌───┬───┐ ┌───┐          ┌───┐
    │P1 │P2 │P3 │ │P4 │ │P5 │ │P6 │P7 │ │P8 │          │P9 │
    │50%│30%│20%│ │100│ │100│ │60%│40%│ │100│          │100│
    │第三级│ │   │     │     │   │   │     │              │
    └───┴───┴───┘ └───┘ └───┘ └───┴───┘ └───┘          └───┘
     面板 面板 面板  面板  面板  面板 面板  面板            面板
```

## 🎯 层级关系详解

### 层级 1：容器层

```
DockLayoutContainer
├─ 定义：停靠位置（left/right/top/bottom/float）
├─ 尺寸：width × height
├─ 位置：x, y（悬浮时）
├─ 布局：分组的排列方向
│   ├─ left/right → 纵向（分组从上到下）
│   ├─ top/bottom → 横向（分组从左到右）
│   └─ float → 自定义方向
└─ 功能：
    ├─ 容器拖拽（悬浮时）
    ├─ 容器调整大小
    ├─ 热区检测
    └─ 自动吸附
```

### 层级 2：分组层

```
PanelGroupContainer
├─ 定义：面板的分组组织
├─ 占比：groupRatio（0~1）
├─ 方向：direction（horizontal/vertical）
├─ 布局：面板的排列方向
└─ 功能：
    ├─ 分组占比调整
    ├─ 面板占比调整
    ├─ 分组间调整手柄
    ├─ 面板间调整手柄
    └─ 合并指示器
```

### 层级 3：面板层

```
DockablePanelGroup（原有组件）
├─ 定义：完整的面板功能
├─ 占比：panelRatio（0~1）
├─ 标签：tabs[]
└─ 功能：
    ├─ 标签页管理
    ├─ 标签页拖拽
    ├─ 面板拖拽
    ├─ 面板合并
    ├─ 调整大小
    └─ 停靠吸附
```

## 📊 布局方向示意图

### 纵向布局（left/right 停靠）

```
容器方向：纵向（分组从上到下）
│
├─ 分组 A（60%高度）
│   ├─ 面板 1（50%）
│   └─ 面板 2（50%）
│
├─ 分组 B（25%高度）
│   └─ 面板 3（100%）
│
└─ 分组 C（15%高度）
    └─ 面板 4（100%）
```

### 横向布局（top/bottom 停靠）

```
容器方向：横向（分组从左到右）

┌─────────────────────────────────────┐
│ 分组A(40%) │ 分组B(35%) │ 分组C(25%)│
│  ├面板1    │  ├面板3    │  └面板5   │
│  └面板2    │  └面板4    │           │
└─────────────────────────────────────┘
```

### 混合布局（分组内自定义方向）

```
容器：纵向

┌────────────────────────┐
│   分组 A（纵向）        │
│   ├─ 面板1             │
│   └─ 面板2             │
├────────────────────────┤
│   分组 B（横向）        │
│   ├─────┬─────┬────────┤
│   │面板3│面板4│面板5   │
│   └─────┴─────┴────────┘
└────────────────────────┘
```

## 🎨 占比计算可视化

### 分组占比

```
容器高度：800px
├─ 分组 A：groupRatio = 0.6
│   实际高度 = 800 × 0.6 = 480px
├─ 分组 B：groupRatio = 0.3
│   实际高度 = 800 × 0.3 = 240px
└─ 分组 C：groupRatio = 0.1
    实际高度 = 800 × 0.1 = 80px

总占比：0.6 + 0.3 + 0.1 = 1.0 ✅
```

### 面板占比

```
分组 A 高度：480px
├─ 面板 1：panelRatio = 0.5
│   实际高度 = 480 × 0.5 = 240px
├─ 面板 2：panelRatio = 0.3
│   实际高度 = 480 × 0.3 = 144px
└─ 面板 3：panelRatio = 0.2
    实际高度 = 480 × 0.2 = 96px

总占比：0.5 + 0.3 + 0.2 = 1.0 ✅
```

## 🔄 拖拽交互流程图

```
┌─────────────────┐
│ 用户按住面板     │
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│ 检测拖动距离     │  距离 > 5px ?
└────────┬────────┘
         │ Yes
         ↓
┌─────────────────┐
│ 显示 Ghost      │  半透明跟随鼠标
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│ 实时检测热区     │
└────────┬────────┘
         │
    ┌────┴────┬────────┬────────┬────────┐
    ↓         ↓        ↓        ↓        ↓
┌────────┐┌────────┐┌────────┐┌────────┐┌────────┐
│边缘热区││容器热区││分组热区││面板热区││无热区  │
└───┬────┘└───┬────┘└───┬────┘└───┬────┘└───┬────┘
    │         │        │        │        │
    ↓         ↓        ↓        ↓        ↓
┌────────┐┌────────┐┌────────┐┌────────┐┌────────┐
│创建容器││合并容器││合并分组││合并面板││保持悬浮│
└───┬────┘└───┬────┘└───┬────┘└───┬────┘└───┬────┘
    │         │        │        │        │
    └─────────┴────────┴────────┴────────┘
                     │
                     ↓
          ┌─────────────────┐
          │ 用户释放鼠标     │
          └─────────────────┘
                     │
                     ↓
          ┌─────────────────┐
          │ 完成操作         │
          └─────────────────┘
```

## 📏 调整手柄可视化

### 分组调整手柄

```
容器（纵向）
│
├─ 分组 A（60%）
│   └─ 面板...
│
├──────────────────── ← 分组调整手柄（宽8px，蓝色线条）
│
├─ 分组 B（40%）
│   └─ 面板...
```

**特点**：
- 宽度：8px（或高度，根据方向）
- 颜色：透明，悬停时蓝色背景
- 手柄线：3px × 60px，深蓝色
- 光标：ew-resize（横向）或 ns-resize（纵向）

### 面板调整手柄

```
分组 A
│
├─ 面板 1（50%）
│
├──────────────────── ← 面板调整手柄（宽6px，浅蓝色线条）
│
├─ 面板 2（50%）
```

**特点**：
- 宽度：6px（或高度，根据方向）
- 颜色：透明，悬停时浅蓝色背景
- 手柄线：2px × 40px，蓝色
- 光标：ew-resize（横向）或 ns-resize（纵向）

## 🎭 热区检测可视化

### 边缘热区（80px）

```
┌────────────────────────────────────────┐
│ ████████ ← 顶部热区（80px）            │
│ █      ┌──────────────────┐          █ │
│ █ 左侧 │                  │  右侧    █ │
│ █ 热区 │   主工作区域      │  热区    █ │
│ █ 80px│                  │  80px   █ │
│ █      └──────────────────┘          █ │
│ ████████ ← 底部热区（80px）            │
└────────────────────────────────────────┘
```

### 容器热区

```
┌────────────────────────────────────────┐
│                                        │
│    ┌──────────────────┐                │
│    │  现有停靠容器     │ ← 悬停显示合并提示│
│    │  ☑☑☑☑☑☑☑☑☑      │                │
│    │  ☑ 分组 A ☑      │                │
│    │  ☑☑☑☑☑☑☑☑☑      │                │
│    └──────────────────┘                │
│                                        │
└────────────────────────────────────────┘
```

## 🎬 使用场景动画

### 场景 1：创建左侧停靠容器

```
步骤 1：拖动悬浮面板
  ┌─────┐
  │面板A│ ← 拖动
  └─────┘

步骤 2：移动到左边缘
  ███████  ← 热区预览
  █     █
  █ ← 停靠到左侧
  █     █
  ███████

步骤 3：释放鼠标
  ┌─────┐
  │面板A│ ← 已停靠
  └─────┘
```

### 场景 2：调整分组占比

```
初始状态：
├─ 分组 A（60%）= 480px
│   └─ 面板 1
│
├─ 分组 B（40%）= 320px
    └─ 面板 2

拖动手柄向下 100px：
├─ 分组 A（72.5%）= 580px ↑
│   └─ 面板 1
│
├─ 分组 B（27.5%）= 220px ↓
    └─ 面板 2

总高度保持 800px 不变 ✅
```

### 场景 3：面板拆分到新分组

```
初始：1个分组，3个面板
┌────────────────┐
│    分组 A       │
│  ├─ 面板 1      │
│  ├─ 面板 2      │
│  └─ 面板 3      │
└────────────────┘

拖动面板 2 到容器中部：
┌────────────────┐
│    分组 A (50%) │
│  ├─ 面板 1      │
│  └─ 面板 3      │
├────────────────┤
│    分组 B (50%) │ ← 新创建
│  └─ 面板 2      │
└────────────────┘
```

## 📊 数据流向图

```
用户操作
   ↓
DockManagerV2（事件处理）
   ↓
DockLayoutContainerV2（容器更新）
   ↓
PanelGroupContainerV2（分组更新）
   ↓
DockablePanelGroup（面板更新）
   ↓
视图更新
   ↓
配置回调（@config-change）
```

## 🎨 样式层次图

```
.dock-manager-v2（总容器）
│
├─ .dock-layout-container-v2（第一级）
│   ├─ .position-left（左侧）
│   ├─ .position-right（右侧）
│   ├─ .position-top（顶部）
│   ├─ .position-bottom（底部）
│   ├─ .is-float（悬浮）
│   ├─ .container-drag-handle（拖拽手柄）
│   └─ .container-resize-handle（调整手柄）
│
├─ .panel-group-container-v2（第二级）
│   ├─ .direction-horizontal（横向）
│   ├─ .direction-vertical（纵向）
│   ├─ .panel-wrapper（面板包装）
│   ├─ .panel-resize-handle（面板手柄）
│   ├─ .group-resize-handle（分组手柄）
│   └─ .merge-indicator（合并指示）
│
└─ .dockable-panel-group（第三级）
    ├─ .panel-docked（停靠状态）
    ├─ .panel-floating（悬浮状态）
    ├─ .panel-dragging（拖拽状态）
    └─ 所有原有样式类
```

## 🔢 占比计算流程图

```
容器总高度：800px
    ↓
┌──────────────────────┐
│ 分组 A：groupRatio=0.6│
│ 计算：800 × 0.6 = 480px│
└──────────┬───────────┘
           │
           ├─ 面板 1：panelRatio=0.5
           │  计算：480 × 0.5 = 240px
           │
           └─ 面板 2：panelRatio=0.5
              计算：480 × 0.5 = 240px
    ↓
┌──────────────────────┐
│ 分组 B：groupRatio=0.4│
│ 计算：800 × 0.4 = 320px│
└──────────┬───────────┘
           │
           └─ 面板 3：panelRatio=1.0
              计算：320 × 1.0 = 320px
```

## 🎯 交互状态图

### 拖拽状态变化

```
静止状态
   ↓ mousedown
准备拖拽
   ↓ 移动 > 5px
拖拽中
   ├─ 显示 Ghost
   ├─ 检测热区
   └─ 更新预览
   ↓ mouseup
   ├─ 有热区 → 执行操作
   └─ 无热区 → 保持悬浮
   ↓
完成状态
```

### 热区状态变化

```
无热区（none）
   ↓ 进入边缘
边缘热区（edge）
   ↓ 离开边缘，进入容器
容器热区（container）
   ↓ 离开容器，进入分组
分组热区（group）
   ↓ 离开分组，进入面板
面板热区（panel）
   ↓ 离开所有区域
无热区（none）
```

## 📐 尺寸关系图

```
窗口
├─ 100% × 100%
│
├─ 左侧容器
│   ├─ width: 300px（固定）
│   ├─ height: 100%（继承）
│   │
│   ├─ 分组 A
│   │   ├─ width: 300px（继承）
│   │   ├─ height: 60%（groupRatio）
│   │   │
│   │   ├─ 面板 1
│   │   │   ├─ width: 300px（继承）
│   │   │   └─ height: 50%（panelRatio）
│   │   │
│   │   └─ 面板 2
│   │       ├─ width: 300px（继承）
│   │       └─ height: 50%（panelRatio）
│   │
│   └─ 分组 B
│       ├─ width: 300px（继承）
│       ├─ height: 40%（groupRatio）
│       │
│       └─ 面板 3
│           ├─ width: 300px（继承）
│           └─ height: 100%（panelRatio）
│
└─ 右侧容器（类似结构）
```

## 🎊 总结

### 关键特点

1. **清晰的三级结构**
   - 容器 → 分组 → 面板
   - 每一级职责明确
   - 层层嵌套，逻辑清晰

2. **灵活的布局方式**
   - 5种停靠模式
   - 2种排列方向
   - 无限嵌套可能

3. **精确的占比控制**
   - groupRatio：分组占比
   - panelRatio：面板占比
   - 自动归一化为 100%

4. **完整的交互功能**
   - 拖拽吸附
   - 占比调整
   - 面板合并
   - 热区检测

---

**📚 查看更多**：[文档索引](./INDEX.md)

**🎯 快速开始**：[快速入门](./V2_QUICK_START.md)

**✅ 完成时间**：2026-01-20

**⭐ 质量评分**：⭐⭐⭐⭐⭐
