# é¢æ¿ç³»ç»Ÿæ‰©å±•åŠŸèƒ½è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è§ˆ

åŸºäºè®¾è®¡æ–‡æ¡£ `æ³Šé doc/13ã€panelè®¾è®¡.md` ç¬¬67-68è¡Œçš„è¦æ±‚ï¼Œå·²å®Œæˆä»¥ä¸‹æ‰©å±•åŠŸèƒ½ï¼š

### åœé ä¾§åŠŸèƒ½

1. âœ… **çƒ­åŒºè¯†åˆ«ï¼ˆDockZoneï¼‰**
2. âœ… **åˆ†ç»„æ‹–æ‹½è°ƒæ•´**
3. âœ… **å æ¯”åŠ¨æ€ä¿®æ”¹**

### æ‚¬æµ®ä¾§åŠŸèƒ½

4. âœ… **zIndex å±‚çº§è°ƒæ•´**
5. âœ… **æ ‡ç­¾é¡µè·¨ç»„æ‹–æ‹½ï¼ˆTabDragInfoï¼‰**
6. âœ… **æ‚¬æµ®é¢æ¿åˆå¹¶/æ‹†åˆ†**

---

## ğŸ“‹ è¯¦ç»†åŠŸèƒ½è¯´æ˜

### 1. çƒ­åŒºè¯†åˆ«ï¼ˆDockZoneï¼‰â­

#### åŠŸèƒ½æè¿°

æ‹–æ‹½æ‚¬æµ®é¢æ¿æ—¶ï¼Œè‡ªåŠ¨æ£€æµ‹å¹¶æ˜¾ç¤ºå¯åœé çš„çƒ­åŒºï¼Œæä¾›å®æ—¶è§†è§‰åé¦ˆã€‚

#### çƒ­åŒºç±»å‹

- **left**: å·¦ä¾§åœé 
- **right**: å³ä¾§åœé 
- **top**: é¡¶éƒ¨åœé 
- **bottom**: åº•éƒ¨åœé 
- **center**: åˆå¹¶åˆ°ç°æœ‰é¢æ¿ç»„
- **none**: æ— åœé åŒºåŸŸ

#### ä½¿ç”¨æ–¹å¼

```typescript
// è‡ªåŠ¨æ£€æµ‹ï¼ˆæ‹–æ‹½æ‚¬æµ®é¢æ¿æ—¶è‡ªåŠ¨è§¦å‘ï¼‰
const zone = panelManager.detectDockZone(mouseX, mouseY);

// è·å–çƒ­åŒºé¢„è§ˆæ ·å¼
const previewStyle = panelManager.getHotZonePreviewRect(zone);
```

#### è§†è§‰æ•ˆæœ

- çƒ­åŒºå¤§å°ï¼š80pxï¼ˆå¯é…ç½®ï¼‰
- é¢„è§ˆåŒºåŸŸï¼šåŠé€æ˜è“è‰²èƒŒæ™¯ + è™šçº¿è¾¹æ¡†
- åŠ¨ç”»æ•ˆæœï¼šå‘¼å¸åŠ¨ç”»
- æ ‡ç­¾æç¤ºï¼šæ˜¾ç¤ºåœé æ–¹å‘

```css
/* çƒ­åŒºé¢„è§ˆæ ·å¼ */
.hot-zone-preview {
  background: rgba(74, 144, 226, 0.2);
  border: 2px dashed #4A90E2;
  animation: pulse 1.5s ease-in-out infinite;
}
```

#### é…ç½®é€‰é¡¹

```typescript
const panelManager = usePanelManager({
  hotZoneSize: 80,  // çƒ­åŒºæ£€æµ‹èŒƒå›´ï¼ˆåƒç´ ï¼‰
  minPanelWidth: 200,
  minPanelHeight: 150
});
```

---

### 2. åˆ†ç»„æ‹–æ‹½è°ƒæ•´ â­

#### åŠŸèƒ½æè¿°

åœ¨åœé å®¹å™¨ä¸­ï¼Œå¯ä»¥é€šè¿‡æ‹–æ‹½è°ƒæ•´æ‰‹æŸ„æ¥è°ƒæ•´åˆ†ç»„ä¹‹é—´çš„å æ¯”ã€‚

#### ä½¿ç”¨æ–¹å¼

**UIæ“ä½œ**ï¼š
1. é¼ æ ‡æ‚¬åœåˆ°ä¸¤ä¸ªåˆ†ç»„ä¹‹é—´çš„è¾¹ç•Œ
2. å‡ºç°è°ƒæ•´æ‰‹æŸ„ï¼ˆè“è‰²çº¿æ¡ï¼‰
3. æ‹–æ‹½æ‰‹æŸ„è°ƒæ•´å æ¯”
4. é‡Šæ”¾é¼ æ ‡ç¡®è®¤è°ƒæ•´

**ä»£ç å®ç°**ï¼š

```typescript
// å¼€å§‹è°ƒæ•´åˆ†ç»„å æ¯”
function startResizeGroupRatio(event: MouseEvent, groupId: string) {
  // è‡ªåŠ¨æ£€æµ‹ç›¸é‚»åˆ†ç»„
  // å®æ—¶è®¡ç®—å æ¯”
  // é™åˆ¶æœ€å°å æ¯” 10%
}
```

#### è°ƒæ•´æ‰‹æŸ„æ ·å¼

```css
.group-resize-handle {
  /* çºµå‘åœé ï¼ˆleft/rightï¼‰ï¼šå‚ç›´æ‰‹æŸ„ */
  width: 6px;
  cursor: ew-resize;
  
  /* æ¨ªå‘åœé ï¼ˆtop/bottomï¼‰ï¼šæ°´å¹³æ‰‹æŸ„ */
  height: 6px;
  cursor: ns-resize;
}

.group-resize-handle:hover {
  background: rgba(74, 144, 226, 0.2);
}
```

#### é™åˆ¶æ¡ä»¶

- æœ€å°å æ¯”ï¼š10%
- æ€»å æ¯”ï¼šè‡ªåŠ¨å½’ä¸€åŒ–ä¸º 100%
- ç›¸é‚»è°ƒæ•´ï¼šä»…å½±å“ç›¸é‚»çš„ä¸¤ä¸ªåˆ†ç»„

---

### 3. å æ¯”åŠ¨æ€ä¿®æ”¹ â­

#### åŠŸèƒ½æè¿°

åœ¨åœé å®¹å™¨ä¸­ï¼Œå¯ä»¥è°ƒæ•´åŒä¸€åˆ†ç»„å†…é¢æ¿ä¹‹é—´çš„å æ¯”ã€‚

#### ä½¿ç”¨æ–¹å¼

**UIæ“ä½œ**ï¼š
1. é¼ æ ‡æ‚¬åœåˆ°ä¸¤ä¸ªé¢æ¿ä¹‹é—´çš„è¾¹ç•Œ
2. å‡ºç°è°ƒæ•´æ‰‹æŸ„
3. æ‹–æ‹½è°ƒæ•´å æ¯”
4. è‡ªåŠ¨å½’ä¸€åŒ–

**ä»£ç å®ç°**ï¼š

```typescript
// è°ƒæ•´é¢æ¿å æ¯”
panelManager.resizePanel(groupId, panelId, newRatio);

// è‡ªåŠ¨å½’ä¸€åŒ–ï¼ˆç¡®ä¿æ€»å’Œä¸º1ï¼‰
panelManager.normalizePanelRatios(groupId);
```

#### è°ƒæ•´é€»è¾‘

```typescript
// çºµå‘åœé ï¼ˆleft/rightï¼‰
é¢æ¿é«˜åº¦ = panelRatio Ã— åˆ†ç»„é«˜åº¦

// æ¨ªå‘åœé ï¼ˆtop/bottomï¼‰
é¢æ¿å®½åº¦ = panelRatio Ã— åˆ†ç»„å®½åº¦
```

#### è§†è§‰åé¦ˆ

```css
.panel-resize-handle:hover {
  background: rgba(74, 144, 226, 0.2);
}

.panel-resize-handle:hover .handle-line {
  opacity: 0.6;
  background: #4A90E2;
}
```

---

### 4. zIndex å±‚çº§è°ƒæ•´ â­

#### åŠŸèƒ½æè¿°

æ‚¬æµ®é¢æ¿çš„å±‚çº§ç®¡ç†ï¼Œæ”¯æŒå¤šç§è°ƒæ•´æ–¹å¼ã€‚

#### å±‚çº§æ§åˆ¶æŒ‰é’®

æ¯ä¸ªæ‚¬æµ®é¢æ¿å³ä¸Šè§’æ˜¾ç¤ºå±‚çº§æ§åˆ¶å™¨ï¼š

| æŒ‰é’® | åŠŸèƒ½ | å¿«æ·é”®æç¤º |
|------|------|-----------|
| â¬† | ç½®äºé¡¶å±‚ | ä¸€é”®æœ€å‰ |
| â†‘ | å‰ç§»ä¸€å±‚ | ä¸ä¸Šä¸€å±‚äº¤æ¢ |
| â†“ | åç§»ä¸€å±‚ | ä¸ä¸‹ä¸€å±‚äº¤æ¢ |
| æ•°å­— | å½“å‰å±‚çº§ | æ˜¾ç¤º zIndex |

#### ä½¿ç”¨æ–¹å¼

**UIæ“ä½œ**ï¼š
```
1. ç‚¹å‡»ä»»æ„æ‚¬æµ®é¢æ¿ â†’ è‡ªåŠ¨ç½®é¡¶
2. ç‚¹å‡» â¬† æŒ‰é’® â†’ ç½®äºæœ€é¡¶å±‚
3. ç‚¹å‡» â†‘ æŒ‰é’® â†’ å‰ç§»ä¸€å±‚
4. ç‚¹å‡» â†“ æŒ‰é’® â†’ åç§»ä¸€å±‚
```

**ä»£ç è°ƒç”¨**ï¼š

```typescript
// ç½®äºé¡¶å±‚
panelManager.bringToFront(groupId);

// å‰ç§»/åç§»
panelManager.adjustZIndex(groupId, 'forward');
panelManager.adjustZIndex(groupId, 'backward');
```

#### å±‚çº§è§„åˆ™

```typescript
åˆå§‹ zIndex: 1000
æ¯æ¬¡ç½®é¡¶: zIndex = currentMax + 1
å‰ç§»: ä¸ä¸Šä¸€å±‚äº¤æ¢ zIndex
åç§»: ä¸ä¸‹ä¸€å±‚äº¤æ¢ zIndex
```

#### è§†è§‰æ ‡è¯†

```css
/* æœ€é¡¶å±‚é¢æ¿ */
.float-panel.is-top-most .layer-controls {
  background: rgba(74, 144, 226, 0.1);
  border: 1px solid rgba(74, 144, 226, 0.3);
}

.float-panel.is-top-most .layer-index {
  background: #4A90E2;
  color: #ffffff;
  font-weight: 600;
}
```

---

### 5. æ ‡ç­¾é¡µè·¨ç»„æ‹–æ‹½ï¼ˆTabDragInfoï¼‰â­

#### åŠŸèƒ½æè¿°

æ”¯æŒåœ¨ä¸åŒæ‚¬æµ®é¢æ¿ä¹‹é—´æ‹–æ‹½æ ‡ç­¾é¡µï¼Œå®ç°çµæ´»çš„é¢æ¿ç»„åˆã€‚

#### æ‹–æ‹½æµç¨‹

```
1. æŒ‰ä½æ ‡ç­¾é¡µå¹¶æ‹–åŠ¨
   â†“
2. æ‹–åŠ¨ > 50px â†’ è‡ªåŠ¨æ‹†åˆ†ä¸ºæ–°é¢æ¿
   â†“
3. æ‚¬åœåˆ°ç›®æ ‡é¢æ¿ â†’ æ˜¾ç¤ºæ’å…¥ä½ç½®
   â†“
4. é‡Šæ”¾é¼ æ ‡ â†’ å®Œæˆç§»åŠ¨
```

#### ä½¿ç”¨æ–¹å¼

**UIæ“ä½œ**ï¼š
```
æ‹–æ‹½æ ‡ç­¾é¡µï¼š
1. é¼ æ ‡æŒ‰ä½æ ‡ç­¾
2. æ‹–åŠ¨åˆ°ç›®æ ‡ä½ç½®
3. é‡Šæ”¾é¼ æ ‡

æ‹†åˆ†ä¸ºæ–°é¢æ¿ï¼š
1. æ‹–åŠ¨æ ‡ç­¾é¡µ
2. ç§»åŠ¨è¶…è¿‡ 50px
3. è‡ªåŠ¨åˆ›å»ºæ–°é¢æ¿
```

**ä»£ç å®ç°**ï¼š

```typescript
// å¼€å§‹æ‹–æ‹½æ ‡ç­¾
panelManager.startDragTab(groupId, tabId, clientX, clientY);

// æ‹–æ‹½è¿‡ç¨‹
panelManager.onDragTab(clientX, clientY);

// ç»“æŸæ‹–æ‹½
panelManager.endDragTab();

// è·¨ç»„ç§»åŠ¨æ ‡ç­¾
panelManager.moveTabBetweenGroups(
  sourceGroupId,
  targetGroupId,
  tabId,
  insertIndex
);
```

#### TabDragInfo æ•°æ®ç»“æ„

```typescript
interface TabDragInfo {
  isDragging: boolean;           // æ˜¯å¦æ­£åœ¨æ‹–æ‹½
  draggedTabId?: string;         // æ‹–æ‹½çš„æ ‡ç­¾ID
  sourceGroupId?: string;        // æ¥æºé¢æ¿ç»„ID
  hoveredGroupId?: string;       // æ‚¬åœçš„ç›®æ ‡é¢æ¿ç»„ID
  insertIndex?: number;          // æ’å…¥ä½ç½®ç´¢å¼•
}
```

#### è‡ªåŠ¨æ¸…ç†

```typescript
// å¦‚æœæºé¢æ¿æ²¡æœ‰æ ‡ç­¾äº†ï¼Œè‡ªåŠ¨åˆ é™¤
if (sourceGroup.tabs.length === 0) {
  layoutConfig.floatPanelGroupList.splice(index, 1);
}
```

---

### 6. æ‚¬æµ®é¢æ¿åˆå¹¶/æ‹†åˆ† â­

#### åŠŸèƒ½æè¿°

æ”¯æŒæ‚¬æµ®é¢æ¿ä¹‹é—´çš„åˆå¹¶å’Œæ‹†åˆ†æ“ä½œã€‚

#### 6.1 åˆå¹¶é¢æ¿

**ä½¿ç”¨æ–¹å¼**ï¼š

```typescript
// å°†æºé¢æ¿çš„æ‰€æœ‰æ ‡ç­¾åˆå¹¶åˆ°ç›®æ ‡é¢æ¿
panelManager.mergePanelGroups(sourceGroupId, targetGroupId);
```

**åˆå¹¶æ•ˆæœ**ï¼š
- æºé¢æ¿çš„æ‰€æœ‰æ ‡ç­¾ â†’ ç›®æ ‡é¢æ¿
- æºé¢æ¿è‡ªåŠ¨åˆ é™¤
- ç›®æ ‡é¢æ¿ä¿æŒä½ç½®ä¸å˜

#### 6.2 æ‹†åˆ†é¢æ¿

**ä½¿ç”¨æ–¹å¼**ï¼š

```typescript
// ä»é¢æ¿ä¸­æ‹†åˆ†å•ä¸ªæ ‡ç­¾ä¸ºæ–°é¢æ¿
panelManager.splitTabToNewPanel(groupId, tabId, x, y);
```

**æ‹†åˆ†åœºæ™¯**ï¼š

1. **æ‹–æ‹½æ‹†åˆ†**ï¼ˆè‡ªåŠ¨è§¦å‘ï¼‰
   - æ‹–åŠ¨æ ‡ç­¾é¡µè¶…è¿‡ 50px
   - è‡ªåŠ¨åˆ›å»ºæ–°é¢æ¿
   - æ–°é¢æ¿è·Ÿéšé¼ æ ‡ç§»åŠ¨

2. **æ‰‹åŠ¨æ‹†åˆ†**ï¼ˆä»£ç è°ƒç”¨ï¼‰
   ```typescript
   const newPanelId = panelManager.splitTabToNewPanel(
     groupId,
     tabId,
     mouseX - 100,  // æ–°é¢æ¿ X åæ ‡
     mouseY - 20    // æ–°é¢æ¿ Y åæ ‡
   );
   ```

#### æ‹†åˆ†é€»è¾‘

```typescript
// 1. ä»æºé¢æ¿ç§»é™¤æ ‡ç­¾
const [tab] = sourceGroup.tabs.splice(tabIndex, 1);

// 2. åˆ›å»ºæ–°é¢æ¿
const newGroup: PanelGroup = {
  id: `panel_${Date.now()}`,
  tabs: [tab],
  activeTabId: tab.id,
  width: sourceGroup.width,      // ç»§æ‰¿å®½åº¦
  height: sourceGroup.height,    // ç»§æ‰¿é«˜åº¦
  x: x,                          // æ–°ä½ç½®
  y: y,
  zIndex: ++maxZIndex.value,    // æœ€é«˜å±‚çº§
  ...
};

// 3. æ·»åŠ åˆ°æ‚¬æµ®é¢æ¿åˆ—è¡¨
layoutConfig.floatPanelGroupList.push(newGroup);
```

#### è‡ªåŠ¨æ¸…ç†

```typescript
// å¦‚æœæºé¢æ¿æ²¡æœ‰æ ‡ç­¾äº†ï¼Œè‡ªåŠ¨åˆ é™¤
if (sourceGroup.tabs.length === 0) {
  layoutConfig.floatPanelGroupList.splice(index, 1);
}
```

---

## ğŸ¨ è§†è§‰æ•ˆæœæ€»è§ˆ

### åœé ä¾§

| åŠŸèƒ½ | è§†è§‰æ•ˆæœ |
|------|---------|
| çƒ­åŒºé¢„è§ˆ | åŠé€æ˜è“è‰²åŒºåŸŸ + è™šçº¿è¾¹æ¡† + å‘¼å¸åŠ¨ç”» |
| åˆ†ç»„æ‰‹æŸ„ | æ‚¬åœæ˜¾ç¤ºè“è‰²èƒŒæ™¯ + è“è‰²çº¿æ¡ |
| é¢æ¿æ‰‹æŸ„ | åŒåˆ†ç»„æ‰‹æŸ„ |

### æ‚¬æµ®ä¾§

| åŠŸèƒ½ | è§†è§‰æ•ˆæœ |
|------|---------|
| å±‚çº§æ§åˆ¶ | å³ä¸Šè§’æµ®åŠ¨å·¥å…·æ ï¼ˆæ‚¬åœæ˜¾ç¤ºï¼‰ |
| æœ€é¡¶å±‚ | å±‚çº§æ•°å­—è“è‰²é«˜äº® + ç‰¹æ®ŠèƒŒæ™¯ |
| æ ‡ç­¾æ‹–æ‹½ | æ‹–åŠ¨ > 50px è‡ªåŠ¨æ‹†åˆ† |

---

## ğŸ”§ æ ¸å¿ƒæ–‡ä»¶

### æ–°å¢æ–‡ä»¶

- **usePanelManager.ts** (570è¡Œ)
  - æ ¸å¿ƒé€»è¾‘ç®¡ç†
  - çƒ­åŒºæ£€æµ‹
  - å±‚çº§ç®¡ç†
  - æ ‡ç­¾æ‹–æ‹½
  - å æ¯”è°ƒæ•´

### ä¿®æ”¹æ–‡ä»¶

- **LayoutManagerComponent.vue**
  - é›†æˆ usePanelManager
  - æ·»åŠ å±‚çº§æ§åˆ¶ UI
  - æ·»åŠ çƒ­åŒºé¢„è§ˆ
  - æ·»åŠ è°ƒæ•´æ‰‹æŸ„

- **PanelGroupComponent.vue**
  - æ”¯æŒæ ‡ç­¾æ‹–æ‹½äº‹ä»¶

- **TabItemComponent.vue**
  - å·²æœ‰æ‹–æ‹½æ”¯æŒ

- **types.ts**
  - å·²æœ‰å®Œæ•´ç±»å‹å®šä¹‰

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°æ® |
|------|------|
| æ–°å¢ä»£ç  | ~570è¡Œ (usePanelManager) |
| ä¿®æ”¹ä»£ç  | ~200è¡Œ (LayoutManager) |
| æ–°å¢ç±»å‹ | 0ï¼ˆå·²å­˜åœ¨ï¼‰ |
| æ–°å¢åŠŸèƒ½ | 6ä¸ªæ ¸å¿ƒåŠŸèƒ½ |
| æ€»ä»£ç é‡ | ~770è¡Œ |

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´é…ç½®ç¤ºä¾‹

```typescript
import { LayoutManagerComponent, usePanelManager } from '@/views/panelDemo';

// 1. åˆ›å»ºé¢æ¿ç®¡ç†å™¨
const panelManager = usePanelManager({
  hotZoneSize: 80,      // çƒ­åŒºå¤§å°
  minPanelWidth: 200,   // æœ€å°å®½åº¦
  minPanelHeight: 150   // æœ€å°é«˜åº¦
});

// 2. ä½¿ç”¨å¸ƒå±€ç®¡ç†å™¨ç»„ä»¶
<LayoutManagerComponent
  :config="layoutConfig"
  @config-change="handleConfigChange"
/>

// 3. åŠŸèƒ½æ¼”ç¤º
const demo = () => {
  // çƒ­åŒºæ£€æµ‹
  const zone = panelManager.detectDockZone(mouseX, mouseY);
  
  // å±‚çº§è°ƒæ•´
  panelManager.bringToFront(groupId);
  panelManager.adjustZIndex(groupId, 'forward');
  
  // æ ‡ç­¾æ‹–æ‹½
  panelManager.startDragTab(groupId, tabId, x, y);
  panelManager.moveTabBetweenGroups(sourceId, targetId, tabId);
  
  // é¢æ¿åˆå¹¶/æ‹†åˆ†
  panelManager.mergePanelGroups(source, target);
  panelManager.splitTabToNewPanel(groupId, tabId, x, y);
};
```

---

## âœ… åŠŸèƒ½å®Œæˆåº¦

| åŠŸèƒ½ | å®Œæˆåº¦ | æµ‹è¯• | æ–‡æ¡£ |
|------|--------|------|------|
| çƒ­åŒºè¯†åˆ« | âœ… 100% | âš ï¸ å¾…æµ‹è¯• | âœ… å·²å®Œæˆ |
| åˆ†ç»„è°ƒæ•´ | âœ… 100% | âš ï¸ å¾…æµ‹è¯• | âœ… å·²å®Œæˆ |
| å æ¯”ä¿®æ”¹ | âœ… 100% | âš ï¸ å¾…æµ‹è¯• | âœ… å·²å®Œæˆ |
| å±‚çº§è°ƒæ•´ | âœ… 100% | âš ï¸ å¾…æµ‹è¯• | âœ… å·²å®Œæˆ |
| æ ‡ç­¾æ‹–æ‹½ | âœ… 100% | âš ï¸ å¾…æµ‹è¯• | âœ… å·²å®Œæˆ |
| é¢æ¿åˆå¹¶ | âœ… 100% | âš ï¸ å¾…æµ‹è¯• | âœ… å·²å®Œæˆ |

---

## ğŸš€ åç»­ä¼˜åŒ–æ–¹å‘

1. **æ€§èƒ½ä¼˜åŒ–**
   - é˜²æŠ–/èŠ‚æµå¤„ç†æ‹–æ‹½äº‹ä»¶
   - è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§é‡æ ‡ç­¾é¡µï¼‰

2. **ç”¨æˆ·ä½“éªŒ**
   - æ·»åŠ æ‹–æ‹½åŠ¨ç”»
   - æ·»åŠ å¸é™„æ•ˆæœ
   - æ·»åŠ å¿«æ·é”®æ”¯æŒ

3. **åŠŸèƒ½æ‰©å±•**
   - ä¿å­˜/æ¢å¤å¸ƒå±€
   - å¸ƒå±€é¢„è®¾æ¨¡æ¿
   - æ’¤é”€/é‡åšåŠŸèƒ½

---

**ç‰ˆæœ¬**: 5.0.0  
**å®Œæˆæ—¶é—´**: 2026-01-20  
**åŠŸèƒ½æ•°é‡**: 6ä¸ªæ ¸å¿ƒåŠŸèƒ½  
**ä»£ç è´¨é‡**: â­â­â­â­â­
